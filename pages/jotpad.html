document.addEventListener('DOMContentLoaded', () => {
    const noteArea = document.getElementById('noteArea');
    const downloadPdfBtn = document.getElementById('downloadPdfBtn');
    const deleteAllBtn = document.getElementById('deleteAllBtn');

    if (!noteArea) return; // Only run on JotPad page

    // Load saved content from localStorage
    noteArea.innerHTML = localStorage.getItem("jotpadContent") || "";

    // Function to save content to localStorage
    const saveContent = () => {
        localStorage.setItem("jotpadContent", noteArea.innerHTML);
    };

    // Use the debounce utility from utilities.js to save on input
    noteArea.addEventListener("input", debounce(saveContent, 500));

    // PDF Download
    downloadPdfBtn.addEventListener('click', async () => {
        const { jsPDF } = window.jspdf;
        const content = noteArea.innerText;
        if (!content.trim()) {
            showMessage("Note is empty. Nothing to download.", "error");
            return;
        }
        const doc = new jsPDF();
        doc.setFont("helvetica", "normal");
        doc.setFontSize(12);
        doc.text(content, 10, 10, { maxWidth: 190 });
        doc.save("NotesVault_JotPad.pdf");
    });

    // Delete All
    deleteAllBtn.addEventListener('click', () => {
        // This can be enhanced with a custom modal in the future
        if (window.confirm("Are you sure you want to delete all content? This cannot be undone.")) {
            noteArea.innerHTML = "";
            localStorage.removeItem("jotpadContent");
            showMessage("All content has been deleted.", "success");
        }
    });
});
